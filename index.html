<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PartyDecor.AI</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      min-height: 100vh;
      transition: background 0.3s;
    }

    body.dark-mode {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #f0f0f0;
    }

    /* Navigation */
    nav {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 1.2rem 2rem;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    body.dark-mode nav {
      background: rgba(30, 30, 30, 0.95);
    }

    .logo {
      font-size: 1.8rem;
      font-weight: bold;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .nav-links {
      display: flex;
      gap: 2rem;
      align-items: center;
    }

    .nav-links a {
      color: #333;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.3s;
      padding: 0.5rem 1rem;
      border-radius: 8px;
    }

    body.dark-mode .nav-links a {
      color: #f0f0f0;
    }

    .nav-links a:hover {
      background: rgba(102, 126, 234, 0.1);
      transform: translateY(-2px);
    }

    .dark-toggle {
      background: #667eea;
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 20px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
    }

    .dark-toggle:hover {
      background: #764ba2;
      transform: scale(1.05);
    }

    /* Container */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 3rem 2rem;
    }

    /* Pages */
    .page {
      display: none;
    }

    .page.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Home Page */
    .hero {
      text-align: center;
      padding: 4rem 2rem;
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      margin-bottom: 3rem;
    }

    body.dark-mode .hero {
      background: rgba(30, 30, 30, 0.8);
    }

    .hero h1 {
      font-size: 3.5rem;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero p {
      font-size: 1.3rem;
      color: #666;
      margin-bottom: 2rem;
    }

    body.dark-mode .hero p {
      color: #aaa;
    }

    .cta-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 1rem 3rem;
      font-size: 1.1rem;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }

    .cta-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
    }

    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-top: 3rem;
    }

    .feature-card {
      background: white;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      transition: all 0.3s;
      text-align: center;
    }

    body.dark-mode .feature-card {
      background: rgba(30, 30, 30, 0.8);
    }

    .feature-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
    }

    .feature-card h3 {
      color: #667eea;
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .feature-card p {
      color: #666;
      line-height: 1.6;
    }

    body.dark-mode .feature-card p {
      color: #aaa;
    }

    /* Decorator Page */
    .decorator-content {
      background: white;
      padding: 3rem;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .decorator-content {
      background: rgba(30, 30, 30, 0.8);
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    label {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #667eea;
    }

    input, select {
      padding: 0.8rem;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 1rem;
      transition: all 0.3s;
    }

    body.dark-mode input,
    body.dark-mode select {
      background: rgba(50, 50, 50, 0.8);
      border-color: #444;
      color: #f0f0f0;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .upload-area {
      border: 3px dashed #667eea;
      border-radius: 15px;
      padding: 3rem;
      text-align: center;
      margin-bottom: 2rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    .upload-area:hover {
      background: rgba(102, 126, 234, 0.05);
    }

    .upload-area.dragover {
      background: rgba(102, 126, 234, 0.1);
      border-color: #764ba2;
    }

    .submit-btn {
      width: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 1.2rem;
      font-size: 1.1rem;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }

    .submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* Results */
    .results-section {
      margin-top: 3rem;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }

    .result-card {
      background: #f9f9f9;
      padding: 1.5rem;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }

    body.dark-mode .result-card {
      background: rgba(50, 50, 50, 0.5);
    }

    .result-card h3 {
      margin-bottom: 1rem;
      color: #667eea;
    }

    .image-container {
      width: 100%;
      height: 300px;
      border-radius: 10px;
      overflow: hidden;
      background: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    body.dark-mode .image-container {
      background: rgba(50, 50, 50, 0.8);
    }

    .image-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .plan-box {
      background: #f9f9f9;
      padding: 2rem;
      border-radius: 15px;
      margin-top: 2rem;
      white-space: pre-wrap;
      font-family: 'Courier New', monospace;
      line-height: 1.8;
    }

    body.dark-mode .plan-box {
      background: rgba(50, 50, 50, 0.5);
    }

    /* Gallery Page */
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }

    .gallery-item {
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      transition: all 0.3s;
      cursor: pointer;
    }

    body.dark-mode .gallery-item {
      background: rgba(30, 30, 30, 0.8);
    }

    .gallery-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }

    .gallery-item img {
      width: 100%;
      height: 250px;
      object-fit: cover;
    }

    .empty-gallery {
      text-align: center;
      padding: 4rem;
      color: #666;
    }

    body.dark-mode .empty-gallery {
      color: #aaa;
    }

    /* Spinner */
    .spinner {
      border: 4px solid rgba(102, 126, 234, 0.1);
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 2rem auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 768px) {
      .hero h1 {
        font-size: 2.5rem;
      }

      .nav-links {
        gap: 1rem;
      }

      .results-grid,
      .gallery-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <nav>
    <div class="logo">üéâ PartyDecor.AI</div>
    <div class="nav-links">
      <a href="#" data-page="home">Home</a>
      <a href="#" data-page="decorator">AI Decorator</a>
      <a href="#" data-page="gallery">Gallery</a>
      <button class="dark-toggle" id="darkToggle">üåô Dark Mode</button>
    </div>
  </nav>

  <div class="container">
    <!-- Home Page -->
    <div class="page active" id="home">
      <div class="hero">
        <h1>Transform Your Space with AI</h1>
        <p>Professional party decoration suggestions powered by artificial intelligence</p>
        <button class="cta-button" onclick="showPage('decorator')">Get Started</button>
      </div>

      <div class="features">
        <div class="feature-card">
          <h3>üé® AI-Powered Design</h3>
          <p>Upload your space and let our AI create stunning decoration suggestions tailored to your event</p>
        </div>
        <div class="feature-card">
          <h3>üí∞ Budget-Friendly</h3>
          <p>Get customized decoration plans that fit your budget with cost-effective material suggestions</p>
        </div>
        <div class="feature-card">
          <h3>üñºÔ∏è Visual Gallery</h3>
          <p>Save and browse all your generated designs in a beautiful gallery for future reference</p>
        </div>
      </div>
    </div>

    <!-- Decorator Page -->
    <div class="page" id="decorator">
      <div class="decorator-content">
        <h2 style="margin-bottom: 2rem; color: #667eea;">AI Room Decorator</h2>
        
        <div class="upload-area" id="uploadArea">
          <p style="font-size: 1.2rem; margin-bottom: 1rem;">üì∏ Upload Your Room Image</p>
          <p style="color: #666;">Click or drag and drop an image here</p>
          <input type="file" id="imageInput" accept="image/*" style="display: none;" />
        </div>

        <div id="previewArea" style="display: none; margin-bottom: 2rem;">
          <img id="previewImage" style="max-width: 100%; border-radius: 10px;" />
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>Room Size</label>
            <select id="roomSize">
              <option value="small">Small</option>
              <option value="medium" selected>Medium</option>
              <option value="large">Large</option>
            </select>
          </div>

          <div class="form-group">
            <label>Occasion</label>
            <input type="text" id="occasion" placeholder="e.g., Birthday, Wedding" />
          </div>

          <div class="form-group">
            <label>Style</label>
            <input type="text" id="style" placeholder="e.g., Modern, Bohemian" />
          </div>

          <div class="form-group">
            <label>Budget (USD)</label>
            <input type="number" id="budget" placeholder="e.g., 500" />
          </div>
        </div>

        <div class="form-group" style="margin-bottom: 2rem;">
          <label>Materials (comma separated)</label>
          <input type="text" id="materials" placeholder="e.g., balloons, string lights, flowers" />
        </div>

        <button class="submit-btn" id="generateBtn">Generate Decoration ‚ú®</button>

        <div class="results-section" id="resultsSection" style="display: none;">
          <h2 style="color: #667eea; margin-bottom: 1rem;">Your Decorated Space</h2>
          
          <div class="results-grid">
            <div class="result-card">
              <h3>Before</h3>
              <div class="image-container" id="beforeImage"></div>
            </div>
            <div class="result-card">
              <h3>After</h3>
              <div class="image-container" id="afterImage"></div>
            </div>
          </div>

          <div class="plan-box" id="decorationPlan"></div>
        </div>
      </div>
    </div>

    <!-- Gallery Page -->
    <div class="page" id="gallery">
      <div style="background: white; padding: 3rem; border-radius: 20px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);">
        <h2 style="margin-bottom: 2rem; color: #667eea;">Your Design Gallery</h2>
        <div class="gallery-grid" id="galleryGrid"></div>
      </div>
    </div>
  </div>

  <script>
    let currentImage = null;
    const API_URL = "http://127.0.0.1:5000/decorate";

    // Dark mode toggle
    const darkToggle = document.getElementById('darkToggle');
    darkToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      darkToggle.textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
    });

    // Navigation
    function showPage(pageName) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(pageName).classList.add('active');
      
      if (pageName === 'gallery') {
        loadGallery();
      }
    }

    document.querySelectorAll('[data-page]').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        showPage(e.target.dataset.page);
      });
    });

    // Upload handling
    const uploadArea = document.getElementById('uploadArea');
    const imageInput = document.getElementById('imageInput');
    const previewArea = document.getElementById('previewArea');
    const previewImage = document.getElementById('previewImage');

    uploadArea.addEventListener('click', () => imageInput.click());

    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file && file.type.startsWith('image/')) {
        handleImageUpload(file);
      }
    });

    imageInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        handleImageUpload(file);
      }
    });

    function handleImageUpload(file) {
      currentImage = file;
      const reader = new FileReader();
      reader.onload = (e) => {
        previewImage.src = e.target.result;
        previewArea.style.display = 'block';
      };
      reader.readAsDataURL(file);
    }

    // Generate decoration
    document.getElementById('generateBtn').addEventListener('click', async () => {
      if (!currentImage) {
        alert('Please upload an image first!');
        return;
      }

      const generateBtn = document.getElementById('generateBtn');
      const resultsSection = document.getElementById('resultsSection');
      const beforeImage = document.getElementById('beforeImage');
      const afterImage = document.getElementById('afterImage');
      const decorationPlan = document.getElementById('decorationPlan');

      generateBtn.disabled = true;
      generateBtn.textContent = 'Generating...';
      
      resultsSection.style.display = 'block';
      beforeImage.innerHTML = '<div class="spinner"></div>';
      afterImage.innerHTML = '<div class="spinner"></div>';
      decorationPlan.textContent = 'Generating your decoration plan...';

      // Show before image
      const reader = new FileReader();
      reader.onload = (e) => {
        beforeImage.innerHTML = `<img src="${e.target.result}" />`;
      };
      reader.readAsDataURL(currentImage);

      const formData = new FormData();
      formData.append('image', currentImage);
      formData.append('room_size', document.getElementById('roomSize').value);
      formData.append('occasion', document.getElementById('occasion').value);
      formData.append('style', document.getElementById('style').value);
      formData.append('budget', document.getElementById('budget').value);
      
      const materials = document.getElementById('materials').value.split(',').map(m => m.trim()).filter(m => m);
      materials.forEach(m => formData.append('materials[]', m));

      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          body: formData
        });

        const data = await response.json();

        if (data.status === 'success') {
          const imgSrc = `data:image/png;base64,${data.image_base64}`;
          afterImage.innerHTML = `<img src="${imgSrc}" />`;
          decorationPlan.textContent = data.text_plan || 'No plan generated.';

          // Save to gallery (using in-memory storage instead of localStorage)
          const saved = JSON.parse(localStorage.getItem('partydecor_gallery') || '[]');
          saved.push({
            before: previewImage.src,
            after: imgSrc,
            plan: data.text_plan,
            timestamp: new Date().toISOString()
          });
          localStorage.setItem('partydecor_gallery', JSON.stringify(saved));
        } else {
          afterImage.innerHTML = '<p style="color: red;">‚ùå Generation failed</p>';
          decorationPlan.textContent = data.message;
        }
      } catch (error) {
        afterImage.innerHTML = '<p style="color: red;">‚ùå Error occurred</p>';
        decorationPlan.textContent = error.message;
      } finally {
        generateBtn.disabled = false;
        generateBtn.textContent = 'Generate Decoration ‚ú®';
      }
    });

    // Gallery
    function loadGallery() {
      const galleryGrid = document.getElementById('galleryGrid');
      const saved = JSON.parse(localStorage.getItem('partydecor_gallery') || '[]');

      if (saved.length === 0) {
        galleryGrid.innerHTML = '<div class="empty-gallery"><h3>No designs yet</h3><p>Start creating beautiful party decorations!</p></div>';
        return;
      }

      galleryGrid.innerHTML = saved.map((item, index) => `
        <div class="gallery-item" onclick='viewGalleryItem(${index})'>
          <img src="${item.after}" alt="Design ${index + 1}" />
        </div>
      `).join('');
    }

    function viewGalleryItem(index) {
      const saved = JSON.parse(localStorage.getItem('partydecor_gallery') || '[]');
      const item = saved[index];
      
      showPage('decorator');
      document.getElementById('resultsSection').style.display = 'block';
      document.getElementById('beforeImage').innerHTML = `<img src="${item.before}" />`;
      document.getElementById('afterImage').innerHTML = `<img src="${item.after}" />`;
      document.getElementById('decorationPlan').textContent = item.plan;
    }
  </script>
</body>
</html>